{% extends 'base.html.twig' %}
 {% block stylesheets %}
 <link rel="stylesheet" href="{{ 'css/search.css' }}">
 {% endblock %}
{% block title %}Team{% endblock %}

{% block body %}
<main class="wrapper">

{% if search is not defined %}
    {% if app.user.team is defined and app.user.team is not null %}
        {% if app.user.isVerifiedTeam == "1"  %}
            <section class="search_page">
            <div>
            <h1>{{ app.user.team.nom }}</h1>
                <h2>{{ app.user.team.description }}</h2>
                <ul>
                    {% for jeu in app.user.team.jeu %}
                        <li class="mb-5">{{ jeu.nom }}</li>
                    {% endfor %}
                </ul>
                {% if app.user.isVerifiedTeam == "1"  %}
                {% if app.user.roleteam != ["ROLE_ADMIN", "ROLE_FONDATEUR"] %}
                <a class="nav_link mr" href="{{ path('app_team_leave')}}">Quitter la team</a>
                {% endif %}
                {% endif %}
            </div>

            <div>
                <a class="nav_link mr" href="{{ path('app_team_event')}}">Les evenement</a>
                <a class="nav_link mr" href="{{ path('app_team_sujet')}}">Les discussions</a>
                <a class="nav_link mr" href="{{ path('app_team_user')}}">Les pilotes</a>

                {% if app.user.roleTeam[0] == "ROLE_ADMIN" or app.user.roleTeam[0] == "ROLE_MODO" %}
                    <a class="nav_link mr" href="{{ path('app_team_confirmation')}}">Les pilotes en attentes ({{ count }})</a>
                {% endif %}

            </div>
            </section>
            {% else %}
            <section class="search_page">
            <div>
            <p>Candidature en attente pour la team :</p>
            <h1>{{ app.user.team.nom }}</h1>
                <a class="nav_link mr" href="{{ path('app_team_leave')}}">Annuler la candidature</a>
            </div>
            </section>
        {% endif %}
    {% endif %}
{% endif %}

<section class="search_page">
    {% if search is defined %}
        <h1 class="mb-5">Voici les résultats pour "{{ search }}"</h1>
        <a class="nav_link mr" href="{{ path('app_team')}}">Retour</a>
    {% endif %}

    {% if is_granted('IS_AUTHENTICATED_REMEMBERED') %}
        {% if app.user.team is not defined or app.user.team is null %}
            <a class="nav_link mr" href="{{ path('app_team_create')}}">Crée une team</a>
        {% endif %}
    {% endif %}

    <div>
        {{ render ( controller ( 'App\\Controller\\TeamController::searchBar' )) }}
    </div>

    <div>
        <ul>
            {% if teamresult is defined %}
                {% for teamresult in teamsearch %}
                    <li>{{ teamresult.nom }}</li>
                {% endfor %}
            {% endif %}

            {% for team in teams %}
                <li><a class="nav_link mr" href="{{ path('app_team_id', { 'id': team.id } )}}">{{ team.nom }}</a></li>

                {% if is_granted('IS_AUTHENTICATED_REMEMBERED') %}
                    {% if app.user.team is null or app.user.team is not defined %}
                        <a class="nav_link mr" href="{{ path('app_team_join', { 'id': team.id } )}}">Rejoindre {{ team.nom }}</a>
                    {% endif %}
                {% endif %}
            {% endfor %}
        </ul>
    </div>
</section>
</main>
{% endblock %}
